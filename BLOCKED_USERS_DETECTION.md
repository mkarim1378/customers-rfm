# Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØ´Ø®ÛŒØµ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡ Ø§Ø² Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù†ÛŒ

## âš ï¸ ØªÙˆØ¬Ù‡: Ø§Ù†ØªØ®Ø§Ø¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡

Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø´Ø§Ù…Ù„ Ú©Ø¯ Ø¨Ø±Ø§ÛŒ **Ø¯Ùˆ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡** Ù…Ø®ØªÙ„Ù Ø§Ø³Øª:

1. **aiogram** (aiogram 2.x / 3.x) - Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø¯Ø±Ù† Ùˆ async
2. **python-telegram-bot** (PTB 13.x / 20.x) - Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù…Ø¹Ø±ÙˆÙ Ùˆ Ù¾Ø§ÛŒØ¯Ø§Ø±

> **âš ï¸ Ù…Ù‡Ù…**: Ø§ÛŒÙ† Ø¯Ùˆ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ **Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ù‡Ù…Ø²Ù…Ø§Ù†** Ø¯Ø± ÛŒÚ© Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆÙ†Ø¯. ÛŒÚ©ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ Ùˆ Ú©Ø¯ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ù…Ø§Ù† Ø±Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.

### ØªÙØ§ÙˆØªâ€ŒÙ‡Ø§:
- `aiogram`: Ø³Ø±ÛŒØ¹â€ŒØªØ±ØŒ Ù…Ø¯Ø±Ù†â€ŒØªØ±ØŒ async Ù…Ø­ÙˆØ±
- `python-telegram-bot`: Ù¾Ø§ÛŒØ¯Ø§Ø±ØªØ±ØŒ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¨ÛŒØ´ØªØ±ØŒ Ø¬Ø§Ù…Ø¹Ù‡ Ø¨Ø²Ø±Ú¯ØªØ±

---

## ğŸ’¡ Ø§ÛŒØ¯Ù‡ Ú©Ù„ÛŒ

Ø¨Ù‡ Ø¬Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… ØªØ³Øª Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ØŒ Ø§Ø² **Ù‡Ù…Ø§Ù† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ** Ú©Ù‡ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒÙØ±Ø³ØªÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ùˆ Ø§Ø² Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ØŒ ØªØ´Ø®ÛŒØµ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… Ú©Ù‡ Ú©Ø¯Ø§Ù… Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø¨Ø§Øª Ø±Ø§ Ø¨Ù„Ø§Ú© Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯.

---

## ğŸ”§ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ

### 1ï¸âƒ£ Ø³Ø§Ø®ØªØ§Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ (Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†)

```python
# Ù…Ø«Ø§Ù„ Ø¨Ø§ SQLite
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY,
    phone TEXT,
    name TEXT,
    status TEXT DEFAULT 'active',  -- active, blocked, inactive
    last_message_sent_at TIMESTAMP,
    last_block_detected_at TIMESTAMP,
    last_activity_at TIMESTAMP
);
```

ÛŒØ§ Ø¨Ø§ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¯ÛŒÚ¯Ø±ÛŒ Ú©Ù‡ Ø¯Ø§Ø±ÛŒØ¯ (PostgreSQL, MySQLØŒ ...)

---

### 2ï¸âƒ£ ØªØ§Ø¨Ø¹ Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ

> **âš ï¸ Ù…Ù‡Ù…**: Ú©Ø¯ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ **aiogram** Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡. Ø§Ú¯Ø± Ø§Ø² **python-telegram-bot** Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŒ Ø¨Ù‡ Ø¨Ø®Ø´ "Ù†Ø³Ø®Ù‡ python-telegram-bot" Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯.

#### ğŸ“¦ Ù†Ø³Ø®Ù‡ aiogram (aiogram 2.x ÛŒØ§ 3.x)

```python
from aiogram import Bot
from aiogram.exceptions import TelegramBadRequest, TelegramForbiddenError
from datetime import datetime
import asyncio

async def broadcast_message_with_block_detection(
    bot: Bot,
    message_text: str,
    users_list: list,  # Ù„ÛŒØ³Øª user_id Ù‡Ø§
    delay: float = 0.05  # ØªØ§Ø®ÛŒØ± Ø¨ÛŒÙ† Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Rate Limit)
):
    """
    Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ Ø¨Ø§ ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡
    """
    success_count = 0
    blocked_count = 0
    failed_count = 0
    blocked_users = []

    for user_id in users_list:
        try:
            # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
            await bot.send_message(
                chat_id=user_id,
                text=message_text
            )

            # Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯ = Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ø§Ù„ Ø§Ø³Øª
            success_count += 1
            await update_user_status(user_id, 'active', message_sent=True)

        except TelegramBadRequest as e:
            error_msg = str(e).lower()

            # ØªØ´Ø®ÛŒØµ Ø¨Ù„Ø§Ú© Ø´Ø¯Ù†
            if any(keyword in error_msg for keyword in [
                'chat not found',
                'chat_id is empty',
                'user is deactivated',
                'bot was blocked'
            ]):
                blocked_count += 1
                blocked_users.append(user_id)
                await update_user_status(user_id, 'blocked', block_detected=True)

            else:
                # Ø®Ø·Ø§ÛŒ Ø¯ÛŒÚ¯Ø± (Ù…Ø«Ù„Ø§Ù‹ Ù…ØªÙ† Ø®ÛŒÙ„ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒ)
                failed_count += 1
                print(f"Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")

        except TelegramForbiddenError:
            # Ú©Ø§Ø±Ø¨Ø± Ø±Ø¨Ø§Øª Ø±Ø§ Ø¨Ù„Ø§Ú© Ú©Ø±Ø¯Ù‡
            blocked_count += 1
            blocked_users.append(user_id)
            await update_user_status(user_id, 'blocked', block_detected=True)

        except Exception as e:
            # Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡
            failed_count += 1
            print(f"Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")

        # ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Rate Limit
        await asyncio.sleep(delay)

    # Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ
    return {
        'total': len(users_list),
        'success': success_count,
        'blocked': blocked_count,
        'failed': failed_count,
        'blocked_users': blocked_users
    }
```

#### ğŸ“¦ Ù†Ø³Ø®Ù‡ python-telegram-bot (python-telegram-bot 13.x ÛŒØ§ 20.x)

```python
from telegram import Bot
from telegram.error import TelegramError, BadRequest, Forbidden, Unauthorized
from datetime import datetime
import asyncio

async def broadcast_message_with_block_detection(
    bot: Bot,
    message_text: str,
    users_list: list,  # Ù„ÛŒØ³Øª user_id Ù‡Ø§
    delay: float = 0.05  # ØªØ§Ø®ÛŒØ± Ø¨ÛŒÙ† Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
):
    """
    Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ Ø¨Ø§ ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡
    (Ù†Ø³Ø®Ù‡ python-telegram-bot)
    """
    success_count = 0
    blocked_count = 0
    failed_count = 0
    blocked_users = []
    
    for user_id in users_list:
        try:
            # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
            await bot.send_message(
                chat_id=user_id,
                text=message_text
            )
            
            # Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯ = Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ø§Ù„ Ø§Ø³Øª
            success_count += 1
            await update_user_status(user_id, 'active', message_sent=True)
            
        except Forbidden:
            # Ú©Ø§Ø±Ø¨Ø± Ø±Ø¨Ø§Øª Ø±Ø§ Ø¨Ù„Ø§Ú© Ú©Ø±Ø¯Ù‡
            blocked_count += 1
            blocked_users.append(user_id)
            await update_user_status(user_id, 'blocked', block_detected=True)
        
        except Unauthorized:
            # Ú©Ø§Ø±Ø¨Ø± Ø±Ø¨Ø§Øª Ø±Ø§ Ø¨Ù„Ø§Ú© Ú©Ø±Ø¯Ù‡ ÛŒØ§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯Ù‡
            blocked_count += 1
            blocked_users.append(user_id)
            await update_user_status(user_id, 'blocked', block_detected=True)
        
        except BadRequest as e:
            error_msg = str(e).lower()
            
            # ØªØ´Ø®ÛŒØµ Ø¨Ù„Ø§Ú© Ø´Ø¯Ù† Ø§Ø² Ø®Ø·Ø§Ù‡Ø§ÛŒ BadRequest
            if any(keyword in error_msg for keyword in [
                'chat not found',
                'chat_id is empty',
                'user is deactivated',
                'bot was blocked'
            ]):
                blocked_count += 1
                blocked_users.append(user_id)
                await update_user_status(user_id, 'blocked', block_detected=True)
            else:
                # Ø®Ø·Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
                failed_count += 1
                print(f"Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
        
        except TelegramError as e:
            # Ø®Ø·Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…
            failed_count += 1
            print(f"Ø®Ø·Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù… Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
        
        except Exception as e:
            # Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡
            failed_count += 1
            print(f"Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
        
        # ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Rate Limit
        await asyncio.sleep(delay)
    
    # Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ
    return {
        'total': len(users_list),
        'success': success_count,
        'blocked': blocked_count,
        'failed': failed_count,
        'blocked_users': blocked_users
    }
```

> **Ù†Ú©ØªÙ‡**: Ø¯Ø± `python-telegram-bot` Ù†Ø³Ø®Ù‡ 20.x Ø§Ø² `context.bot` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯:
> ```python
> await context.bot.send_message(chat_id=user_id, text=message_text)
> ```

---

### 3ï¸âƒ£ ØªØ§Ø¨Ø¹ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø±

```python
async def update_user_status(
    user_id: int,
    status: str,  # 'active', 'blocked', 'inactive'
    message_sent: bool = False,
    block_detected: bool = False,
    activity: bool = False
):
    """
    Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    """
    now = datetime.now()

    if message_sent:
        # Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ÛŒ
        db.execute(
            "UPDATE users SET last_message_sent_at = ?, status = 'active' WHERE user_id = ?",
            (now, user_id)
        )

    if block_detected:
        # Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø²Ù…Ø§Ù† ØªØ´Ø®ÛŒØµ Ø¨Ù„Ø§Ú©
        db.execute(
            "UPDATE users SET status = 'blocked', last_block_detected_at = ? WHERE user_id = ?",
            (now, user_id)
        )

    if activity:
        # Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª
        db.execute(
            "UPDATE users SET last_activity_at = ?, status = 'active' WHERE user_id = ?",
            (now, user_id)
        )
```

---

### 4ï¸âƒ£ Ø¯Ø³ØªÙˆØ± Ø¢Ù…Ø§Ø±Ú¯ÛŒØ±ÛŒ (Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡)

```python
async def get_statistics_command(message: Message):
    """
    Ø¯Ø³ØªÙˆØ± Ø¢Ù…Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø¨Ø§ Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡
    """
    # Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø± Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    total_users = db.execute("SELECT COUNT(*) FROM users").fetchone()[0]
    users_with_phone = db.execute("SELECT COUNT(*) FROM users WHERE phone IS NOT NULL").fetchone()[0]
    users_without_phone = total_users - users_with_phone
    active_users = db.execute(
        "SELECT COUNT(*) FROM users WHERE status = 'active'"
    ).fetchone()[0]
    blocked_users = db.execute(
        "SELECT COUNT(*) FROM users WHERE status = 'blocked'"
    ).fetchone()[0]

    # Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯Ù‡Ø§
    active_percent = (active_users / total_users * 100) if total_users > 0 else 0
    blocked_percent = (blocked_users / total_users * 100) if total_users > 0 else 0

    # Ø³Ø§Ø®Øª Ù¾ÛŒØ§Ù… Ø¢Ù…Ø§Ø±
    stats_message = f"""
ğŸ“Š Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø¨Ø§Øª:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¥ Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: {total_users:,}
ğŸ“± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡: {users_with_phone:,}
âŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø¯ÙˆÙ† Ø´Ù…Ø§Ø±Ù‡: {users_without_phone:,}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„: {active_users:,} ({active_percent:.1f}%)
ğŸš« Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡: {blocked_users:,} ({blocked_percent:.1f}%)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ˆ Ù†Ø±Ø® ÙØ¹Ø§Ù„: {(active_users/total_users*100) if total_users > 0 else 0:.1f}%
    """

    await message.answer(stats_message)
```

---

### 5ï¸âƒ£ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ú©Ø¯ Ø§ØµÙ„ÛŒ Ø±Ø¨Ø§Øª

#### ğŸ“¦ Ù†Ø³Ø®Ù‡ aiogram

```python
from aiogram import Router, Bot
from aiogram.types import Message
from aiogram.filters import Command

router = Router()

@router.message(Command("broadcast"))
async def broadcast_handler(message: Message, bot: Bot):
    if not is_admin(message.from_user.id):
        return

    # Ø¯Ø±ÛŒØ§ÙØª Ù…ØªÙ† Ù¾ÛŒØ§Ù… Ø§Ø² Ø§Ø¯Ù…ÛŒÙ†
    broadcast_text = message.text.replace("/broadcast", "").strip()

    # Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    all_users = db.execute("SELECT user_id FROM users").fetchall()
    user_ids = [row[0] for row in all_users]

    # Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§ ØªØ´Ø®ÛŒØµ Ø¨Ù„Ø§Ú©
    result = await broadcast_message_with_block_detection(
        bot=bot,
        message_text=broadcast_text,
        users_list=user_ids,
        delay=0.05
    )

    # Ú¯Ø²Ø§Ø±Ø´ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†
    report = f"""
ğŸ“¤ Ú¯Ø²Ø§Ø±Ø´ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙÙ‚: {result['success']}
ğŸš« Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡: {result['blocked']}
âŒ Ø®Ø·Ø§: {result['failed']}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š Ú©Ù„: {result['total']}
    """

    await message.answer(report)
```

#### ğŸ“¦ Ù†Ø³Ø®Ù‡ python-telegram-bot

```python
from telegram import Update
from telegram.ext import ContextTypes, CommandHandler

async def broadcast_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_admin(update.effective_user.id):
        return

    # Ø¯Ø±ÛŒØ§ÙØª Ù…ØªÙ† Ù¾ÛŒØ§Ù… Ø§Ø² Ø§Ø¯Ù…ÛŒÙ†
    broadcast_text = update.message.text.replace("/broadcast", "").strip()

    # Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    all_users = db.execute("SELECT user_id FROM users").fetchall()
    user_ids = [row[0] for row in all_users]

    # Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§ ØªØ´Ø®ÛŒØµ Ø¨Ù„Ø§Ú© (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² context.bot)
    result = await broadcast_message_with_block_detection(
        bot=context.bot,
        message_text=broadcast_text,
        users_list=user_ids,
        delay=0.05
    )

    # Ú¯Ø²Ø§Ø±Ø´ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†
    report = f"""
ğŸ“¤ Ú¯Ø²Ø§Ø±Ø´ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙÙ‚: {result['success']}
ğŸš« Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡: {result['blocked']}
âŒ Ø®Ø·Ø§: {result['failed']}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š Ú©Ù„: {result['total']}
    """

    await update.message.reply_text(report)

# Ø«Ø¨Øª handler
application.add_handler(CommandHandler("broadcast", broadcast_handler))
```

---

## ğŸ¯ Ù…Ø²Ø§ÛŒØ§ÛŒ Ø§ÛŒÙ† Ø±ÙˆØ´

âœ… **Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ§Ù… Ø§Ø¶Ø§ÙÛŒ**: Ø§Ø² Ù‡Ù…Ø§Ù† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯  
âœ… **Ø¨Ø¯ÙˆÙ† Ø§Ø°ÛŒØª Ú©Ø§Ø±Ø¨Ø±**: Ú©Ø§Ø±Ø¨Ø± Ù¾ÛŒØ§Ù… Ø§Ø¶Ø§ÙÛŒ Ù†Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ø¯  
âœ… **Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±**: Ù‡Ø± Ø¨Ø§Ø± Ú©Ù‡ Ù¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÙØ±Ø³ØªÛŒØ¯ØŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯  
âœ… **Ø¯Ù‚ÛŒÙ‚**: Ø¨Ø± Ø§Ø³Ø§Ø³ Ø®Ø·Ø§Ù‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…  
âœ… **Ú©Ø§Ø±Ø§**: Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡

---

## ğŸ“ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

1. **Rate Limit**: Ø­ØªÙ…Ø§Ù‹ delay Ø¨ÛŒÙ† Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯ (Ø­Ø¯Ø§Ù‚Ù„ 0.05 Ø«Ø§Ù†ÛŒÙ‡)

2. **Error Handling**: Ù‡Ù…Ù‡ Ø®Ø·Ø§Ù‡Ø§ Ø±Ø§ catch Ú©Ù†ÛŒØ¯ Ùˆ ÙÙ‚Ø· Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¨Ù„Ø§Ú© Ø±Ø§ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯

3. **Ø°Ø®ÛŒØ±Ù‡ ØªØ§Ø±ÛŒØ®**: ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† ØªØ´Ø®ÛŒØµ Ø¨Ù„Ø§Ú© Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ ØªØ§ Ø¨Ø¯Ø§Ù†ÛŒØ¯ Ú†Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡

4. **Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª**: Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯ (Ù…Ø«Ù„Ø§Ù‹ Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯)ØŒ ÙˆØ¶Ø¹ÛŒØª Ø±Ø§ Ø¨Ù‡ 'active' ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯

5. **Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ**: Ø¨Ø±Ø§ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø²ÛŒØ§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² asyncio.gather Ø¨Ø§ batch Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯

---

## ğŸ”„ Ø­Ø§Ù„Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ (Optional)

Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø¹Ø¯ Ø§Ø² Ù…Ø¯ØªÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ú©Ù‡ Ø¢ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯Ù‡:

```python
async def recheck_blocked_users(bot: Bot):
    """
    Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬Ø¯Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡ (Ù…Ø«Ù„Ø§Ù‹ Ù‡Ø± Ù‡ÙØªÙ‡)
    """
    blocked_users = db.execute(
        "SELECT user_id FROM users WHERE status = 'blocked'"
    ).fetchall()

    for (user_id,) in blocked_users:
        try:
            # ØªØ³Øª Ø¨Ø§ Ù¾ÛŒØ§Ù… Ø®Ø§Ù…ÙˆØ´
            await bot.send_message(
                chat_id=user_id,
                text=".",  # Ù…ØªÙ† Ú©ÙˆØªØ§Ù‡
                disable_notification=True
            )
            # Ù…ÙˆÙÙ‚ Ø´Ø¯ = Ú©Ø§Ø±Ø¨Ø± Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯
            await update_user_status(user_id, 'active')
        except:
            # Ù‡Ù†ÙˆØ² Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡
            pass
```
